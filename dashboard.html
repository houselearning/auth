<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CoolMathTime - Learning Dashboard</title>
    
    <!-- Link to a style.css is not possible in this single-file environment, 
         so we include all necessary CSS here. -->
    
    <!-- Use Firebase 9.x compatibility libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="dashboard/init/app.js"></script>
    <link rel="stylesheet" href="dashboard/init/style.css">

</head>
<body>

    <!-- Header -->
    <header class="app-header">
        <div class="logo">CoolMathTime</div>
        <button id="nav-action-button" class="main-nav-button">Action</button>
    </header>

    <!-- Main Dashboard Content -->
    <div class="container" id="dashboard-content">
        <!-- Content inserted dynamically by renderDashboard() -->
        <div class="loading-message">Loading authentication status...</div>
    </div>

    <!-- ==================================================================== -->
    <!-- MODALS -->
    <!-- ==================================================================== -->

    <!-- 1. Role Switch Confirmation Modal -->
    <div id="role-switch-modal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-header">
                Confirm Role Switch
            </div>
            <div class="modal-body">
                <p>Are you sure you want to switch to the **Coach/Teacher** view?</p>
                <p>This allows you to create classes and manage assignments.</p>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button id="cancel-switch" class="secondary-button" style="margin-left: 0;">Cancel</button>
                <button id="confirm-switch" class="primary-button">Confirm Switch</button>
            </div>
        </div>
    </div>

    <!-- 2. Class Settings Modal (Full Featured) -->
    <div id="class-settings-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <span id="settings-class-name">Class Name</span> Settings
                <span class="close-button" onclick="document.getElementById('class-settings-modal').style.display='none';">&times;</span>
            </div>
            <div class="modal-body">
                
                <!-- Hidden input to store class data -->
                <input type="hidden" id="class-code-input" value=""> 

                <div class="setting-group">
                    <h3>General Settings</h3>
                    <div class="form-group">
                        <label for="class-name-input">Class Name:</label>
                        <input type="text" id="class-name-input" placeholder="e.g., Algebra 101" class="full-width-input">
                    </div>
                    <div class="form-group">
                        <label>Join Code (Read-Only):</label>
                        <input type="text" id="class-code-display" value="CODE" readonly class="full-width-input disabled-input">
                    </div>
                    <div class="form-group">
                        <label>Admin Contact:</label>
                        <input type="text" id="admin-email-display" value="admin@coolmathtime.com" readonly class="full-width-input disabled-input">
                    </div>
                </div>

                <div class="setting-group" style="margin-top: 20px;">
                    <h3>Student Interaction Permissions</h3>
                    <div class="toggle-group">
                        <label for="allow-posting-toggle">Allow students to create new content/posts:</label>
                        <label class="switch">
                            <input type="checkbox" id="allow-posting-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <label for="allow-commenting-toggle">Allow students to comment on posts:</label>
                        <label class="switch">
                            <input type="checkbox" id="allow-commenting-toggle" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-group" style="margin-top: 20px;">
                    <h3>Class Invitation</h3>
                    <div class="form-group">
                        <label>Shareable Invite Link:</label>
                        <input type="text" id="invite-link-display" value="" readonly class="full-width-input invite-link-input" 
                               onclick="this.select(); document.execCommand('copy'); alert('Link copied!');">
                        <small>Click the link above to copy it to your clipboard.</small>
                    </div>
                </div>
                
            </div>
            <!-- UPDATED FOOTER with Delete Button -->
            <div class="modal-footer">
                <button id="delete-class-btn" class="danger-button" data-class-name="" data-class-code="">
                    üóëÔ∏è Delete Class
                </button>
                <div class="button-group-right">
                    <button id="cancel-settings-btn" class="secondary-button">Cancel</button>
                    <button id="save-settings-btn" class="primary-button">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 3. GENERIC INFO DIALOG MODAL (For "Already in Class" message/Join Code) -->
    <div id="info-dialog-modal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-header">
                <span id="info-dialog-title"></span>
                <span class="close-button" onclick="document.getElementById('info-dialog-modal').style.display='none';">&times;</span>
            </div>
            <div class="modal-body">
                <p id="info-dialog-body"></p>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button class="primary-button" onclick="document.getElementById('info-dialog-modal').style.display='none';" style="margin-left: 0;">Close</button>
            </div>
        </div>
    </div>
    
    <!-- 4. DANGER CONFIRMATION DIALOG MODAL (For Deletion) -->
    <div id="confirm-dialog-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="background-color: var(--ka-red-error); color: white;">
                <span id="confirm-dialog-title">Delete Class</span>
                <span class="close-button" onclick="document.getElementById('confirm-dialog-modal').style.display='none';">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirm-dialog-body" style="font-weight: 500;"></p>
                <p style="font-size: 0.9rem; color: var(--ka-red-dark); font-weight: 600;">
                    This action is permanent and cannot be undone.
                </p>
            </div>
            <div class="modal-footer" style="justify-content: flex-end; align-items: center;">
                <button id="confirm-delete-cancel" class="secondary-button" style="margin-right: 10px;">Cancel</button>
                <button id="confirm-delete-action" class="danger-button" style="margin-left: 0;">Yes, Delete Permanently</button>
            </div>
        </div>
    </div>


    <!-- 5. Class Management Modal (Lists all classes for settings) -->
    <div id="class-management-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                Select Class to Manage Settings
                <span class="close-button" onclick="document.getElementById('class-management-modal').style.display='none';">&times;</span>
            </div>
            <div class="modal-body">
                <p>Select a class below to view or change its permissions and name.</p>
                <div id="class-management-list">
                    <!-- Class list will be dynamically inserted here -->
                    <div class="loading-message">Loading classes...</div>
                </div>
            </div>
            <div class="modal-footer" style="justify-content: flex-end;">
                <button class="primary-button" onclick="document.getElementById('class-management-modal').style.display='none';" style="margin-left: 0;">Done</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden Iframe for Apps Script Form Submission (CORS Bypass) -->
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="handlePostResponse();"></iframe>

    <script>
       
    </script>
</body>
</html>

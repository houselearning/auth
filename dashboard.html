<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8" />
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  Â  <title>CoolMathTime - Learning Dashboard</title>
Â  Â  <link rel="stylesheet" href="style.css">Â 
Â  Â  <script src="https://houselearning.github.io/cookiebanner.js"></script>Â 
Â  Â Â 
Â  Â  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* KHAN ACADEMY STYLE VARIABLES & RESET */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --ka-blue-dark: #142838;
Â  Â  Â  Â  Â  Â  --ka-blue-bright: #14a4cc;
Â  Â  Â  Â  Â  Â  --ka-gray-light: #f7f7f7;
Â  Â  Â  Â  Â  Â  --ka-text-color: #2e333b;
Â  Â  Â  Â  Â  Â  --ka-accent-green: #008064; /* For progress/success */
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: var(--ka-gray-light);Â 
Â  Â  Â  Â  Â  Â  color: var(--ka-text-color);
Â  Â  Â  Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* NAVBAR - Minimal and clean */
Â  Â  Â  Â  .navbar {
Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #ddd;
Â  Â  Â  Â  Â  Â  padding: 15px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .navbar-content {
Â  Â  Â  Â  Â  Â  max-width: 1000px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  Â  Â  padding: 0 20px;
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  justify-content: space-between;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-links {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 25px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .navbar-content a {
Â  Â  Â  Â  Â  Â  color: var(--ka-blue-dark);
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  font-size: 0.95em;
Â  Â  Â  Â  }
Â  Â  Â  Â  .navbar-content a:hover {
Â  Â  Â  Â  Â  Â  color: var(--ka-blue-bright);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Join Class Button Style (Applies to Teacher's 'Create Assignment' as well) */
Â  Â  Â  Â  .action-button {
Â  Â  Â  Â  Â  Â  background-color: var(--ka-blue-bright);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 8px 15px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  transition: background-color 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .action-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #0d8cb5;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* MAIN DASHBOARD CONTAINER */
Â  Â  Â  Â  .dashboard-container {
Â  Â  Â  Â  Â  Â  max-width: 1000px;
Â  Â  Â  Â  Â  Â  margin: 40px auto;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-radius: 4px;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* HEADER AND CONTROLS */
Â  Â  Â  Â  .header-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  padding-bottom: 15px;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--ka-gray-light);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  font-size: 2em;
Â  Â  Â  Â  Â  Â  color: var(--ka-blue-dark);
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .logout-button {
Â  Â  Â  Â  Â  Â  background-color: #f0f0f0;Â 
Â  Â  Â  Â  Â  Â  color: var(--ka-blue-dark);
Â  Â  Â  Â  Â  Â  padding: 8px 15px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  transition: background-color 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .logout-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #e5e5e5;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .role-switch {
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  margin-bottom: 25px;
Â  Â  Â  Â  Â  Â  padding: 10px 0;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #eee;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .role-switch button, .active-role {
Â  Â  Â  Â  Â  Â  padding: 4px 8px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  color: var(--ka-text-color);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .active-role {
Â  Â  Â  Â  Â  Â  background: var(--ka-blue-bright);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-color: var(--ka-blue-bright);
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  }
Â  Â  Â  Â  .role-switch button:hover:not(.active-role) {
Â  Â  Â  Â  Â  Â  background: #eee;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* FEATURE SECTIONS */
Â  Â  Â  Â  .section-title {
Â  Â  Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  Â  Â  color: var(--ka-blue-dark);
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .feature-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* FEATURE CARD STYLE */
Â  Â  Â  Â  .feature-card {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column; /* Allows content stacking */
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  transition: border-color 0.2s, box-shadow 0.2s;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  color: var(--ka-text-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  .feature-card:hover {
Â  Â  Â  Â  Â  Â  border-color: var(--ka-blue-bright);
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(20, 164, 204, 0.15);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .card-header {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  color: var(--ka-blue-dark);
Â  Â  Â  Â  }
Â  Â  Â  Â  .card-meta {
Â  Â  Â  Â  Â  Â  font-size: 0.85em;
Â  Â  Â  Â  Â  Â  color: #777;
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Icon styling */
Â  Â  Â  Â  .feature-card span.icon {
Â  Â  Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  Â  Â  margin-right: 15px;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Highlight card (Progress/Mastery) */
Â  Â  Â  Â  .highlight-progress {
Â  Â  Â  Â  Â  Â  background: var(--ka-accent-green);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-color: var(--ka-accent-green);
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  }
Â  Â  Â  Â  .highlight-progress span.icon {
Â  Â  Â  Â  Â  Â  filter: drop-shadow(0 0 1px rgba(255, 255, 255, 0.7));Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .highlight-progress:hover {
Â  Â  Â  Â  Â  Â  background: #006b51;
Â  Â  Â  Â  Â  Â  border-color: #006b51;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0, 128, 100, 0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* EMPTY STATE MESSAGE - Neutral and encouraging */
Â  Â  Â  Â  .empty-state-message {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 40px 20px;
Â  Â  Â  Â  Â  Â  background: var(--ka-gray-light);
Â  Â  Â  Â  Â  Â  border: 2px dashed #ccc;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  color: var(--ka-text-color);
Â  Â  Â  Â  Â  Â  font-size: 1.3em;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Style for a loading state */
Â  Â  Â  Â  .loading-message {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 40px 20px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  color: #888;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* MODAL STYLES (Confirmation Dialog) */
Â  Â  Â  Â  .modal {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  overflow: auto;
Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.4);
Â  Â  Â  Â  Â  Â  display: none; /* Hidden by default */
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-content {
Â  Â  Â  Â  Â  Â  background-color: #fefefe;
Â  Â  Â  Â  Â  Â  margin: 15% auto;Â 
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border: 1px solid #888;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  width: 80%;Â 
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-actions button {
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  margin: 5px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  #confirm-switch {
Â  Â  Â  Â  Â  Â  background-color: #dc3545; /* Red for warning */
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  #cancel-switch {
Â  Â  Â  Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  Â  Â  Â  color: var(--ka-text-color);
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <nav class="navbar">
Â  Â  Â  Â  <div class="navbar-content">
Â  Â  Â  Â  Â  Â  <div class="nav-links">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://houselearning.github.io/home/#">Home</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://houselearning.github.io/home/math-page.html">Courses</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://houselearning.github.io/home/science-page.html#">Coaches</a>
Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://houselearning.github.io/home/computer-science-page.html#">Progress</a>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button class="action-button" id="nav-action-button" onclick="alert('Join Class functionality is not yet implemented.');">
Â  Â  Â  Â  Â  Â  Â  Â  Join Class
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </nav>

Â  Â  <main class="dashboard-container" id="dashboard-content">
Â  Â  Â  Â  </main>

Â  Â  <div id="role-switch-modal" class="modal">
Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h2>âš ï¸ Warning: Role Change</h2>
Â  Â  Â  Â  <p id="modal-message">
Â  Â  Â  Â  Â  Â  Are you sure you want to switch account types? **All your student progress will be lost.**
Â  Â  Â  Â  </p>
Â  Â  Â  Â  <div class="modal-actions">
Â  Â  Â  Â  Â  Â  <button id="cancel-switch">Cancel</button>
Â  Â  Â  Â  Â  Â  <button id="confirm-switch">Switch Role</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>


Â  Â  <script>
Â  Â  Â  Â  // ======================================================================
Â  Â  Â  Â  // 1. FIREBASE INITIALIZATION & SETUP
Â  Â  Â  Â  // ======================================================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  // âš ï¸ IMPORTANT: The config must match the one used in your auth.js
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDoXSwni65CuY1_32ZE8B1nwfQO_3VNpTw",
Â  Â  Â  Â  Â  Â  authDomain: "contract-center-llc-10.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "contract-center-llc-10",
Â  Â  Â  Â  Â  Â  storageBucket: "contract-center-llc-10.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "323221512767",
Â  Â  Â  Â  Â  Â  appId: "1:323221512767:web:6421260f875997dbf64e8a",
Â  Â  Â  Â  };
Â  Â  Â  Â  const app = firebase.initializeApp(firebaseConfig);
Â  Â  Â  Â  const auth = firebase.auth();
Â  Â  Â  Â  const db = firebase.firestore();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // DOM Elements
Â  Â  Â  Â  const dashboardContent = document.getElementById('dashboard-content');
Â  Â  Â  Â  const roleSwitchModal = document.getElementById('role-switch-modal');
Â  Â  Â  Â  const confirmSwitchBtn = document.getElementById('confirm-switch');
Â  Â  Â  Â  const cancelSwitchBtn = document.getElementById('cancel-switch');
Â  Â  Â  Â  const navActionButton = document.getElementById('nav-action-button');
Â  Â  Â  Â Â 
Â  Â  Â  Â  let currentUserId = null;


Â  Â  Â  Â  // ======================================================================
Â  Â  Â  Â  // 2. DASHBOARD RENDERING LOGIC
Â  Â  Â  Â  // ======================================================================

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Renders the appropriate dashboard view (Student or Teacher)
Â  Â  Â  Â  Â * @param {string} role - 'student' or 'teacher'
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function renderDashboard(role) {
Â  Â  Â  Â  Â  Â  let content = '';
Â  Â  Â  Â  Â  Â  let header = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. Update the main navigation button
Â  Â  Â  Â  Â  Â  if (role === 'teacher') {
Â  Â  Â  Â  Â  Â  Â  Â  Â navActionButton.textContent = 'Create Assignment';
Â  Â  Â  Â  Â  Â  Â  Â  Â navActionButton.onclick = () => alert('Assignment creation form would open here!');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  navActionButton.textContent = 'Join Class';
Â  Â  Â  Â  Â  Â  Â  Â  navActionButton.onclick = () => alert('Join Class functionality is not yet implemented.');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Render the dashboard body
Â  Â  Â  Â  Â  Â  if (role === 'student') {
Â  Â  Â  Â  Â  Â  Â  Â  header = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="header-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1>Your Learning Dashboard</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="logout-btn" class="logout-button">Sign Out</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="role-switch">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Current View:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="current-role" class="active-role">Student</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="teacher-role-btn">Switch to Coach View</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  // Student View Content
Â  Â  Â  Â  Â  Â  Â  Â  content = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">ğŸ“ My Assignments & Recommended Practice</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="loading-assignments" class="loading-message">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Loading your assignments...
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-grid assignment-grid" style="display: none;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="no-assignments-message" class="empty-state-message" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‰ Woohoo! No assignments here. Go explore!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">ğŸ“Š Progress & Mastery</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card highlight-progress">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">âœ…</span> View Full Progress Report / Grades
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">ğŸ†</span> My Badges & Energy Points
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">ğŸ§­</span> Explore All Subjects & Courses
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">ğŸ“Œ</span> Review Course Enrollment
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">ğŸ› ï¸ Tools & Account</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">ğŸ‘¤</span> Profile & Settings
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">â“</span> Help Center & Support
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">ğŸ”’</span> Change Password
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">ğŸ“£</span> Email & Notification Preferences
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon">ğŸ</span> Refer a Friend
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  } else if (role === 'teacher') {
Â  Â  Â  Â  Â  Â  Â  Â  header = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="header-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1>Coach Dashboard</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="logout-btn" class="logout-button">Sign Out</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="role-switch">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Current View:</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="current-role" class="active-role">Teacher</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="teacher-role-btn">Switch to Student View</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  // Teacher View Content - Added id="view-all-students-card"
Â  Â  Â  Â  Â  Â  Â  Â  content = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">ğŸ“š My Classes & Groups</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="loading-classes" class="loading-message">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Loading your classes...
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-grid class-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="no-classes-message" class="empty-state-message" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ¨ No classes found. Create one to get started!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">ğŸ‘©â€ğŸ“ Student Roster Overview</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card" id="view-all-students-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span class="icon">ğŸ“‹</span> View All Students</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-meta">Access full roster and student accounts.</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span class="icon">ğŸ””</span> Pending Student Requests</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-meta">0 students pending approval.</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span class="icon">âš™ï¸</span> Manage Class Settings</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-meta">Change class codes, grading scales, and permissions.</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dashboardContent.innerHTML = header + content;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Re-attach listeners and load dynamic data
Â  Â  Â  Â  Â  Â  if (currentUserId) {
Â  Â  Â  Â  Â  Â  Â  Â  attachDashboardListeners(role);
Â  Â  Â  Â  Â  Â  Â  Â  if (role === 'teacher') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadTeacherData(currentUserId);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadAssignments(currentUserId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Function for the Create Class action
Â  Â  Â  Â  function createClassAction() {
Â  Â  Â  Â  Â  Â  alert('Create Class form would open here!');
Â  Â  Â  Â  Â  Â  // In a real app, this would navigate to a form or open a modal
Â  Â  Â  Â  }

Â  Â  Â  Â  // Function for the View All Students action
Â  Â  Â  Â  function viewAllStudentsAction() {
Â  Â  Â  Â  Â  Â  alert('Redirecting to the View All Students roster page!');
Â  Â  Â  Â  Â  Â  // In a real app, this would navigate to the student management page, e.g.,
Â  Â  Â  Â  Â  Â  // window.location.href = 'teacher-roster.html';
Â  Â  Â  Â  }


Â  Â  Â  Â  // ======================================================================
Â  Â  Â  Â  // 3. FIREBASE DATA & ROLE MANAGEMENT
Â  Â  Â  Â  // ======================================================================

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Fetches user role from Firestore profile. If no profile exists, creates one as 'student'.
Â  Â  Â  Â  Â * @param {string} userId - The Firebase UID.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  async function loadUserRole(userId) {
Â  Â  Â  Â  Â  Â  const docRef = db.collection('user_profiles').doc(userId);
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const doc = await docRef.get();
Â  Â  Â  Â  Â  Â  Â  Â  let role = 'student';Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (doc.exists) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  role = doc.data().role || 'student';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialize profile for new user
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await docRef.set({ role: 'student', createdAt: firebase.firestore.FieldValue.serverTimestamp() });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderDashboard(role);

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error loading user role:", error);
Â  Â  Â  Â  Â  Â  Â  Â  // Fallback to student view if Firestore read fails
Â  Â  Â  Â  Â  Â  Â  Â  renderDashboard('student');
Â  Â  Â  Â  Â  Â  Â  Â  loadAssignments(userId);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Saves the new role to Firestore and updates the UI.
Â  Â  Â  Â  Â * @param {string} newRole - 'student' or 'teacher'
Â  Â  Â  Â  Â */
Â  Â  Â  Â  async function saveNewRole(newRole) {
Â  Â  Â  Â  Â  Â  if (!currentUserId) return;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await db.collection('user_profiles').doc(currentUserId).update({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  role: newRole,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastSwitchedAt: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  roleSwitchModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  renderDashboard(newRole);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error saving new role:", error);
Â  Â  Â  Â  Â  Â  Â  Â  alert('Could not save role change to database. Please try again. Make sure your Firestore rules for user_profiles are correct.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Fetches and displays assignments for the student.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function loadAssignments(userId) {
Â  Â  Â  Â  Â  Â  const assignmentGrid = document.querySelector('.assignment-grid');
Â  Â  Â  Â  Â  Â  const noAssignmentsMsg = document.getElementById('no-assignments-message');
Â  Â  Â  Â  Â  Â  const loadingMsg = document.getElementById('loading-assignments');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!assignmentGrid || !loadingMsg) return;

Â  Â  Â  Â  Â  Â  loadingMsg.style.display = 'block';
Â  Â  Â  Â  Â  Â  assignmentGrid.style.display = 'none';
Â  Â  Â  Â  Â  Â  noAssignmentsMsg.style.display = 'none';
Â  Â  Â  Â  Â  Â  assignmentGrid.innerHTML = '';Â 

Â  Â  Â  Â  Â  Â  const assignmentsRef = db.collection('assignments')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .where('studentId', '==', userId)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .orderBy('dueDate', 'asc');Â 

Â  Â  Â  Â  Â  Â  assignmentsRef.onSnapshot((snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  assignmentGrid.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const assignments = [];

Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach(doc => assignments.push({ id: doc.id, ...doc.data() }));
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  loadingMsg.style.display = 'none';Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (assignments.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  assignments.forEach(assignment => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const icon = assignment.type === 'quiz' ? 'ğŸ¯' : assignment.type === 'video' ? 'ğŸ“½ï¸' : 'ğŸ“';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const title = assignment.title || 'Untitled Assignment';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dueDate = assignment.dueDate && assignment.dueDate.seconds ?Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `<div class="card-meta">Due: ${new Date(assignment.dueDate.seconds * 1000).toLocaleDateString()}</div>` : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cardHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span class="icon">${icon}</span> ${title}</div>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dueDate}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  assignmentGrid.innerHTML += cardHtml;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  assignmentGrid.style.display = 'grid';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noAssignmentsMsg.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  assignmentGrid.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noAssignmentsMsg.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error loading assignments: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  loadingMsg.textContent = "Error loading data. Please refresh.";
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Fetches and displays the teacher's classes, including the conditional 'Create Class' button.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function loadTeacherData(userId) {
Â  Â  Â  Â  Â  Â  const classGrid = document.querySelector('.class-grid');
Â  Â  Â  Â  Â  Â  const noClassesMsg = document.getElementById('no-classes-message');
Â  Â  Â  Â  Â  Â  const loadingMsg = document.getElementById('loading-classes');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!classGrid || !loadingMsg) return;

Â  Â  Â  Â  Â  Â  loadingMsg.style.display = 'block';
Â  Â  Â  Â  Â  Â  classGrid.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  noClassesMsg.style.display = 'none';

Â  Â  Â  Â  Â  Â  // âš ï¸ Assumes a Firestore collection 'classes' with a 'teacherId' field
Â  Â  Â  Â  Â  Â  const classesRef = db.collection('classes')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .where('teacherId', '==', userId)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .orderBy('name', 'asc');Â 

Â  Â  Â  Â  Â  Â  classesRef.onSnapshot((snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  classGrid.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  const classes = [];

Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach(doc => classes.push({ id: doc.id, ...doc.data() }));
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  loadingMsg.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  classGrid.style.display = 'grid';Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (classes.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noClassesMsg.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  classes.forEach(cls => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const studentCount = cls.studentCount !== undefined ? cls.studentCount : '...';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const classCode = cls.code || 'N/A';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cardHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span class="icon">ğŸ«</span> ${cls.name || 'Untitled Class'}</div>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-meta">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Students: ${studentCount} | Code: <strong>${classCode}</strong>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  classGrid.innerHTML += cardHtml;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // If no classes, show the dedicated "Create Class" button card
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const createClassCardHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="feature-card highlight-progress" id="create-class-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span class="icon">â•</span> Create Class</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-meta">Click here to set up your first class!</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  classGrid.innerHTML = createClassCardHtml;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noClassesMsg.style.display = 'none'; // Replaced by the dedicated card
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Attach click listener specifically for the new card
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('create-class-card').onclick = createClassAction;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error loading classes: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  loadingMsg.textContent = "Error loading classes. Please check your Firestore rules.";
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }


Â  Â  Â  Â  // ======================================================================
Â  Â  Â  Â  // 4. EVENT LISTENERS
Â  Â  Â  Â  // ======================================================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Attaches listeners to dynamically created elements.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function attachDashboardListeners(currentRole) {
Â  Â  Â  Â  Â  Â  const logoutBtn = document.getElementById('logout-btn');
Â  Â  Â  Â  Â  Â  const teacherRoleBtn = document.getElementById('teacher-role-btn');
Â  Â  Â  Â  Â  Â  const viewAllStudentsCard = document.getElementById('view-all-students-card');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (logoutBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  logoutBtn.onclick = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await auth.signOut();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Logout Error:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (teacherRoleBtn) {
Â  Â  Â  Â  Â  Â  Â  Â  teacherRoleBtn.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetRole = currentRole === 'student' ? 'teacher' : 'student';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentRole === 'student' && targetRole === 'teacher') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Show warning modal for Student to Teacher switch
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  roleSwitchModal.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmSwitchBtn.onclick = () => saveNewRole(targetRole);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelSwitchBtn.onclick = () => roleSwitchModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Teacher to Student switch (no warning)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveNewRole(targetRole);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Make 'View All Students' button functional for the Teacher view
Â  Â  Â  Â  Â  Â  if (currentRole === 'teacher' && viewAllStudentsCard) {
Â  Â  Â  Â  Â  Â  Â  Â  viewAllStudentsCard.onclick = viewAllStudentsAction;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- CHECK AUTH STATUS AND REDIRECT IF NOT LOGGED IN ---
Â  Â  Â  Â  auth.onAuthStateChanged(user => {
Â  Â  Â  Â  Â  Â  if (!user) {
Â  Â  Â  Â  Â  Â  Â  Â  // User is signed out, redirect to index
Â  Â  Â  Â  Â  Â  Â  Â  window.location.replace('index.html');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // User is signed in
Â  Â  Â  Â  Â  Â  Â  Â  currentUserId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  loadUserRole(user.uid);Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
